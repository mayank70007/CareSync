<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="icon" href="data:," />
  <script src="/js/auth.js"></script>
</head>
<body>
  <main class="card">
    <div class="row"><h1>Dashboard</h1>
      <nav class="row" style="gap:.5rem">
        <a class="tile" href="/">Home</a>
        <a class="tile" id="loginLink" href="/login.html">Login</a>
        <button id="logoutBtn" class="tile" style="display:none">Logout</button>
      </nav>
    </div>
    <div class="grid" id="stats"></div>
  </main>

  <script>
    document.getElementById('logoutBtn').addEventListener('click', logoutAndGoLogin);
    function renderUI(){ renderAuthNav('loginLink','logoutBtn'); }

    async function loadStats(){
      ensureLogin(['ROLE_ADMIN','ROLE_DOCTOR']);
      const res = await authFetch('/dashboard/stats', { headers: { 'Accept':'application/json' } });
      if(!res.ok){
        document.getElementById('stats').innerHTML = '<div class="note">Failed to load stats.</div>';
        return;
      }
      const stats = await res.json();
      const grid = document.getElementById('stats');
      grid.innerHTML = '';
      Object.entries(stats).forEach(([k,v]) => {
        const a = document.createElement('div');
        a.className = 'tile';
        a.innerHTML = `<div class="muted">${k}</div><div style="font-size:28px;margin-top:6px">${v}</div>`;
        grid.appendChild(a);
      });
    }
    renderUI();
    loadStats();
  </script>
</body>
</html>
